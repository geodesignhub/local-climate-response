!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).terraDrawMaplibreGlAdapter={})}(this,function(t){function e(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function i(){return i=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},i.apply(this,arguments)}var r,o;function a(t){return Boolean(t&&"object"==typeof t&&null!==t&&!Array.isArray(t))}function s(t){return!!function(t){return"number"==typeof t&&!isNaN(new Date(t).valueOf())}(t)}!function(t){t.Commit="commit",t.Provisional="provisional",t.Finish="finish"}(r||(r={})),function(t){t.Drawing="drawing",t.Select="select",t.Static="static",t.Render="render"}(o||(o={}));var l=/*#__PURE__*/function(){var t,n,s=l.prototype;function l(t){this._state=void 0,this._styles=void 0,this.behaviors=[],this.validate=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.projection=void 0,this.type=o.Drawing,this.mode="base",this._state="unregistered",this._styles=t&&t.styles?i({},t.styles):{},this.pointerDistance=t&&t.pointerDistance||40,this.validate=t&&t.validation,this.projection=t&&t.projection||"web-mercator"}return s.registerBehaviors=function(t){},s.setDrawing=function(){if("started"!==this._state)throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"},s.setStarted=function(){if("stopped"!==this._state&&"registered"!==this._state&&"drawing"!==this._state&&"selecting"!==this._state)throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)},s.setStopped=function(){if("started"!==this._state)throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)},s.register=function(t){if("unregistered"!==this._state)throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=t.store,this.store.registerOnChange(t.onChange),this.setDoubleClickToZoom=t.setDoubleClickToZoom,this.project=t.project,this.unproject=t.unproject,this.onSelect=t.onSelect,this.onDeselect=t.onDeselect,this.setCursor=t.setCursor,this.onStyleChange=t.onChange,this.onFinish=t.onFinish,this.coordinatePrecision=t.coordinatePrecision,this.registerBehaviors({mode:t.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:t.coordinatePrecision,projection:this.projection})},s.validateFeature=function(t){return this.performFeatureValidation(t)},s.performFeatureValidation=function(t){if("unregistered"===this._state)throw new Error("Mode must be registered");var e=function(t,e){var n;if(a(t))if(null==t.id)n="Feature has no id";else if("string"!=typeof t.id&&"number"!=typeof t.id)n="Feature must be string or number as per GeoJSON spec";else if(e(t.id))if(a(t.geometry))if(a(t.properties))if("string"==typeof t.geometry.type&&["Polygon","LineString","Point"].includes(t.geometry.type))if(Array.isArray(t.geometry.coordinates)){if(!t.properties.mode||"string"!=typeof t.properties.mode)return{valid:!1,reason:"Feature does not have a valid mode property"}}else n="Feature coordinates is not an array";else n="Feature is not Point, LineString or Polygon";else n="Feature has no properties";else n="Feature has no geometry";else n="Feature must match the id strategy (default is UUID4)";else n="Feature is not object";return n?{valid:!1,reason:n}:{valid:!0}}(t,this.store.idStrategy.isValidId);if(this.validate){var n=this.validate(t,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:r.Provisional});return{valid:e.valid&&n.valid,reason:n.reason}}return{valid:e.valid,reason:e.reason}},s.validateModeFeature=function(t,e){var n=this.performFeatureValidation(t);return n.valid?t.properties.mode!==this.mode?{valid:!1,reason:"Feature mode property does not match the mode being added to"}:e(t):{valid:!1,reason:n.reason}},s.onFinish=function(t,e){},s.onDeselect=function(t){},s.onSelect=function(t){},s.onKeyDown=function(t){},s.onKeyUp=function(t){},s.onMouseMove=function(t){},s.onClick=function(t){},s.onDragStart=function(t,e){},s.onDrag=function(t,e){},s.onDragEnd=function(t,e){},s.getHexColorStylingValue=function(t,e,n){return this.getStylingValue(t,e,n)},s.getNumericStylingValue=function(t,e,n){return this.getStylingValue(t,e,n)},s.getStylingValue=function(t,e,n){return void 0===t?e:"function"==typeof t?t(n):t},t=l,n=[{key:"state",get:function(){return this._state},set:function(t){throw new Error("Please use the modes lifecycle methods")}},{key:"styles",get:function(){return this._styles},set:function(t){if("object"!=typeof t)throw new Error("Styling must be an object");this.onStyleChange([],"styling"),this._styles=t}}],n&&function(t,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,e(r.key),r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}();function c(t,e){void 0===e&&(e=9);var n=Math.pow(10,e);return Math.round(t*n)/n}function d(t,e,n,i,r){for(;i>n;){if(i-n>600){var o=i-n+1,a=e-n+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);d(t,e,Math.max(n,Math.floor(e-a*l/o+c)),Math.min(i,Math.floor(e+(o-a)*l/o+c)),r)}var u=t[e],p=n,g=i;for(h(t,n,e),r(t[i],u)>0&&h(t,n,i);p<g;){for(h(t,p,g),p++,g--;r(t[p],u)<0;)p++;for(;r(t[g],u)>0;)g--}0===r(t[n],u)?h(t,n,g):h(t,++g,i),g<=e&&(n=g+1),e<=g&&(i=g-1)}}function h(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function u(t,e){p(t,0,t.children.length,e,t)}function p(t,e,n,i,r){r||(r=M([])),r.minX=Infinity,r.minY=Infinity,r.maxX=-Infinity,r.maxY=-Infinity;for(var o=e;o<n;o++){var a=t.children[o];g(r,t.leaf?i(a):a)}return r}function g(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function f(t,e){return t.minX-e.minX}function m(t,e){return t.minY-e.minY}function v(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function y(t){return t.maxX-t.minX+(t.maxY-t.minY)}function _(t,e){var n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function x(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function b(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function M(t){return{children:t,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function E(t,e,n,i,r){for(var o=[e,n];o.length;)if(!((n=o.pop())-(e=o.pop())<=i)){var a=e+Math.ceil((n-e)/i/2)*i;d(t,a,e,n,r),o.push(e,a,a,n)}}var w=/*#__PURE__*/function(){function t(t){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}var e=t.prototype;return e.search=function(t){var e=this.data,n=[];if(!b(t,e))return n;for(var i=this.toBBox,r=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?i(a):a;b(t,s)&&(e.leaf?n.push(a):x(t,s)?this._all(a,n):r.push(a))}e=r.pop()}return n},e.collides=function(t){var e=this.data;if(b(t,e))for(var n=[];e;){for(var i=0;i<e.children.length;i++){var r=e.children[i],o=e.leaf?this.toBBox(r):r;if(b(t,o)){if(e.leaf||x(t,o))return!0;n.push(r)}}e=n.pop()}return!1},e.load=function(t){if(t.length<this._minEntries)for(var e=0;e<t.length;e++)this.insert(t[e]);else{var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n}},e.insert=function(t){this._insert(t,this.data.height-1)},e.clear=function(){this.data=M([])},e.remove=function(t){for(var e,n,i=this.data,r=this.toBBox(t),o=[],a=[],s=!1;i||o.length;){if(i||(i=o.pop(),n=o[o.length-1],e=a.pop(),s=!0),i.leaf){var l=i.children.indexOf(t);-1!==l&&(i.children.splice(l,1),o.push(i),this._condense(o))}s||i.leaf||!x(i,r)?n?(e++,i=n.children[e],s=!1):i=null:(o.push(i),a.push(e),e=0,n=i,i=i.children[0])}},e.toBBox=function(t){return t},e.compareMinX=function(t,e){return t.minX-e.minX},e.compareMinY=function(t,e){return t.minY-e.minY},e._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},e._build=function(t,e,n,i){var r,o=n-e+1,a=this._maxEntries;if(o<=a)return u(r=M(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,i-1))),(r=M([])).leaf=!1,r.height=i;var s=Math.ceil(o/a),l=s*Math.ceil(Math.sqrt(a));E(t,e,n,l,this.compareMinX);for(var c=e;c<=n;c+=l){var d=Math.min(c+l-1,n);E(t,c,d,s,this.compareMinY);for(var h=c;h<=d;h+=s){var p=Math.min(h+s-1,d);r.children.push(this._build(t,h,p,i-1))}}return u(r,this.toBBox),r},e._chooseSubtree=function(t,e,n,i){for(;i.push(e),!e.leaf&&i.length-1!==n;){for(var r=void 0,o=Infinity,a=Infinity,s=0;s<e.children.length;s++){var l=e.children[s],c=v(l),d=(h=t,u=l,(Math.max(u.maxX,h.maxX)-Math.min(u.minX,h.minX))*(Math.max(u.maxY,h.maxY)-Math.min(u.minY,h.minY))-c);d<a?(a=d,o=c<o?c:o,r=l):d===a&&c<o&&(o=c,r=l)}e=r||e.children[0]}var h,u;return e},e._insert=function(t,e,n){var i=n?t:this.toBBox(t),r=[],o=this._chooseSubtree(i,this.data,e,r);for(o.children.push(t),g(o,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)},e._split=function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var o=this._chooseSplitIndex(n,r,i),a=M(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,u(n,this.toBBox),u(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)},e._splitRoot=function(t,e){this.data=M([t,e]),this.data.height=t.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},e._chooseSplitIndex=function(t,e,n){for(var i,r=Infinity,o=Infinity,a=e;a<=n-e;a++){var s=p(t,0,a,this.toBBox),l=p(t,a,n,this.toBBox),c=_(s,l),d=v(s)+v(l);c<r?(r=c,i=a,o=d<o?d:o):c===r&&d<o&&(o=d,i=a)}return i||n-e},e._chooseSplitAxis=function(t,e,n){var i=t.leaf?this.compareMinX:f,r=t.leaf?this.compareMinY:m;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)},e._allDistMargin=function(t,e,n,i){t.children.sort(i);for(var r=this.toBBox,o=p(t,0,e,r),a=p(t,n-e,n,r),s=y(o)+y(a),l=e;l<n-e;l++){var c=t.children[l];g(o,t.leaf?r(c):c),s+=y(o)}for(var d=n-e-1;d>=e;d--){var h=t.children[d];g(a,t.leaf?r(h):h),s+=y(a)}return s},e._adjustParentBBoxes=function(t,e,n){for(var i=n;i>=0;i--)g(e[i],t)},e._condense=function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():u(t[n],this.toBBox)},t}(),D=/*#__PURE__*/function(){function t(t){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new w(t&&t.maxEntries?t.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}var e=t.prototype;return e.setMaps=function(t,e){this.idToNode.set(t.id,e),this.nodeToId.set(e,t.id)},e.toBBox=function(t){var e,n=[],i=[];if("Polygon"===t.geometry.type)e=t.geometry.coordinates[0];else if("LineString"===t.geometry.type)e=t.geometry.coordinates;else{if("Point"!==t.geometry.type)throw new Error("Not a valid feature to turn into a bounding box");e=[t.geometry.coordinates]}for(var r=0;r<e.length;r++)i.push(e[r][1]),n.push(e[r][0]);var o=Math.min.apply(Math,i),a=Math.max.apply(Math,i);return{minX:Math.min.apply(Math,n),minY:o,maxX:Math.max.apply(Math,n),maxY:a}},e.insert=function(t){if(this.idToNode.get(String(t.id)))throw new Error("Feature already exists");var e=this.toBBox(t);this.setMaps(t,e),this.tree.insert(e)},e.load=function(t){var e=this,n=[],i=new Set;t.forEach(function(t){var r=e.toBBox(t);if(e.setMaps(t,r),i.has(String(t.id)))throw new Error("Duplicate feature ID found "+t.id);i.add(String(t.id)),n.push(r)}),this.tree.load(n)},e.update=function(t){this.remove(t.id);var e=this.toBBox(t);this.setMaps(t,e),this.tree.insert(e)},e.remove=function(t){var e=this.idToNode.get(t);if(!e)throw new Error(t+" not inserted into the spatial index");this.tree.remove(e)},e.clear=function(){this.tree.clear()},e.search=function(t){var e=this;return this.tree.search(this.toBBox(t)).map(function(t){return e.nodeToId.get(t)})},e.collides=function(t){return this.tree.collides(this.toBBox(t))},t}(),S={getId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})},isValidId:function(t){return"string"==typeof t&&36===t.length}},C=/*#__PURE__*/function(){function t(t){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=function(){},this.store={},this.spatialIndex=new D,this.tracked=!t||!1!==t.tracked,this.idStrategy=t&&t.idStrategy?t.idStrategy:S}var e=t.prototype;return e.clone=function(t){return JSON.parse(JSON.stringify(t))},e.getId=function(){return this.idStrategy.getId()},e.has=function(t){return Boolean(this.store[t])},e.load=function(t,e){var n=this;if(0===t.length)return[];var i=this.clone(t),r=[],o=[];return i=i.filter(function(t){null==t.id&&(t.id=n.idStrategy.getId());var i=t.id;if(e){var a=e(t);if(!a.valid)return o.push({id:i,valid:!1,reason:a.reason}),!1}if(n.tracked){if(t.properties.createdAt){if(!s(t.properties.createdAt))return o.push({id:t.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else t.properties.createdAt=+new Date;if(t.properties.updatedAt){if(!s(t.properties.updatedAt))return o.push({id:t.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else t.properties.updatedAt=+new Date}return n.has(i)?(o.push({id:i,valid:!1,reason:"Feature already exists with this id: "+i}),!1):(n.store[i]=t,r.push(i),o.push({id:i,valid:!0}),!0)}),this.spatialIndex.load(i),this._onChange(r,"create"),o},e.search=function(t,e){var n=this,i=this.spatialIndex.search(t).map(function(t){return n.store[t]});return this.clone(e?i.filter(e):i)},e.registerOnChange=function(t){this._onChange=function(e,n){t(e,n)}},e.getGeometryCopy=function(t){var e=this.store[t];if(!e)throw new Error("No feature with this id ("+t+"), can not get geometry copy");return this.clone(e.geometry)},e.getPropertiesCopy=function(t){var e=this.store[t];if(!e)throw new Error("No feature with this id ("+t+"), can not get properties copy");return this.clone(e.properties)},e.updateProperty=function(t){var e=this,n=[];t.forEach(function(t){var i=t.id,r=t.property,o=t.value,a=e.store[i];if(!a)throw new Error("No feature with this ("+i+"), can not update geometry");n.push(i),a.properties[r]=o,e.tracked&&(a.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(n,"update")},e.updateGeometry=function(t){var e=this,n=[];t.forEach(function(t){var i=t.id,r=t.geometry;n.push(i);var o=e.store[i];if(!o)throw new Error("No feature with this ("+i+"), can not update geometry");o.geometry=e.clone(r),e.spatialIndex.update(o),e.tracked&&(o.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(n,"update")},e.create=function(t){var e=this,n=[];return t.forEach(function(t){var r,o=t.geometry,a=t.properties,s=i({},a);e.tracked&&(r=+new Date,a?(s.createdAt="number"==typeof a.createdAt?a.createdAt:r,s.updatedAt="number"==typeof a.updatedAt?a.updatedAt:r):s={createdAt:r,updatedAt:r});var l=e.getId(),c={id:l,type:"Feature",geometry:o,properties:s};e.store[l]=c,e.spatialIndex.insert(c),n.push(l)}),this._onChange&&this._onChange([].concat(n),"create"),n},e.delete=function(t){var e=this;t.forEach(function(t){if(!e.store[t])throw new Error("No feature with this id, can not delete");delete e.store[t],e.spatialIndex.remove(t)}),this._onChange&&this._onChange([].concat(t),"delete")},e.copyAll=function(){var t=this;return this.clone(Object.keys(this.store).map(function(e){return t.store[e]}))},e.clear=function(){this.store={},this.spatialIndex.clear()},e.size=function(){return Object.keys(this.store).length},t}(),P=function(t){var e=this,n=t.name,i=t.callback,r=t.unregister,o=t.register;this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=n,this.register=function(){e.registered||(e.registered=!0,o(i))},this.unregister=function(){e.register&&(e.registered=!1,r(i))},this.callback=i},k={__proto__:null,GeoJSONStore:C,TerraDrawBaseDrawMode:l,TerraDrawBaseAdapter:/*#__PURE__*/function(){function t(t){this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance="number"==typeof t.minPixelDragDistance?t.minPixelDragDistance:1,this._minPixelDragDistanceSelecting="number"==typeof t.minPixelDragDistanceSelecting?t.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing="number"==typeof t.minPixelDragDistanceDrawing?t.minPixelDragDistanceDrawing:8,this._coordinatePrecision="number"==typeof t.coordinatePrecision?t.coordinatePrecision:9}var e=t.prototype;return e.getButton=function(t){return-1===t.button?"neither":0===t.button?"left":1===t.button?"middle":2===t.button?"right":"neither"},e.getMapElementXYPosition=function(t){var e=this.getMapEventElement().getBoundingClientRect();return{containerX:t.clientX-e.left,containerY:t.clientY-e.top}},e.getDrawEventFromEvent=function(t){var e=this.getLngLatFromEvent(t);if(!e)return null;var n=e.lng,i=e.lat,r=this.getMapElementXYPosition(t),o=r.containerX,a=r.containerY,s=this.getButton(t),l=Array.from(this._heldKeys);return{lng:c(n,this._coordinatePrecision),lat:c(i,this._coordinatePrecision),containerX:o,containerY:a,button:s,heldKeys:l}},e.register=function(t){this._currentModeCallbacks=t,this._listeners=this.getAdapterListeners(),this._listeners.forEach(function(t){t.register()})},e.getCoordinatePrecision=function(){return this._coordinatePrecision},e.getAdapterListeners=function(){var t=this;return[new P({name:"pointerdown",callback:function(e){if(t._currentModeCallbacks&&e.isPrimary){var n=t.getDrawEventFromEvent(e);n&&(t._dragState="pre-dragging",t._lastDrawEvent=n)}},register:function(e){t.getMapEventElement().addEventListener("pointerdown",e)},unregister:function(e){t.getMapEventElement().removeEventListener("pointerdown",e)}}),new P({name:"pointermove",callback:function(e){if(t._currentModeCallbacks&&e.isPrimary){e.preventDefault();var n=t.getDrawEventFromEvent(e);if(n)if("not-dragging"===t._dragState)t._currentModeCallbacks.onMouseMove(n),t._lastDrawEvent=n;else if("pre-dragging"===t._dragState){if(!t._lastDrawEvent)return;var i={x:t._lastDrawEvent.containerX,y:t._lastDrawEvent.containerY},r={x:n.containerX,y:n.containerY},o=t._currentModeCallbacks.getState(),a=function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(i*i+n*n)}(i,r);if("drawing"===o?a<t._minPixelDragDistanceDrawing:"selecting"===o?a<t._minPixelDragDistanceSelecting:a<t._minPixelDragDistance)return;t._dragState="dragging",t._currentModeCallbacks.onDragStart(n,function(e){t.setDraggability.bind(t)(e)})}else"dragging"===t._dragState&&t._currentModeCallbacks.onDrag(n,function(e){t.setDraggability.bind(t)(e)})}},register:function(e){t.getMapEventElement().addEventListener("pointermove",e)},unregister:function(e){t.getMapEventElement().removeEventListener("pointermove",e)}}),new P({name:"contextmenu",callback:function(e){t._currentModeCallbacks&&e.preventDefault()},register:function(e){t.getMapEventElement().addEventListener("contextmenu",e)},unregister:function(e){t.getMapEventElement().removeEventListener("contextmenu",e)}}),new P({name:"pointerup",callback:function(e){if(t._currentModeCallbacks&&e.target===t.getMapEventElement()&&e.isPrimary){var n=t.getDrawEventFromEvent(e);n&&("dragging"===t._dragState?t._currentModeCallbacks.onDragEnd(n,function(e){t.setDraggability.bind(t)(e)}):"not-dragging"!==t._dragState&&"pre-dragging"!==t._dragState||t._currentModeCallbacks.onClick(n),t._dragState="not-dragging",t.setDraggability(!0))}},register:function(e){t.getMapEventElement().addEventListener("pointerup",e)},unregister:function(e){t.getMapEventElement().removeEventListener("pointerup",e)}}),new P({name:"keyup",callback:function(e){t._currentModeCallbacks&&(t._heldKeys.delete(e.key),t._currentModeCallbacks.onKeyUp({key:e.key,heldKeys:Array.from(t._heldKeys),preventDefault:function(){return e.preventDefault()}}))},register:function(e){t.getMapEventElement().addEventListener("keyup",e)},unregister:function(e){t.getMapEventElement().removeEventListener("keyup",e)}}),new P({name:"keydown",callback:function(e){t._currentModeCallbacks&&(t._heldKeys.add(e.key),t._currentModeCallbacks.onKeyDown({key:e.key,heldKeys:Array.from(t._heldKeys),preventDefault:function(){return e.preventDefault()}}))},register:function(e){t.getMapEventElement().addEventListener("keydown",e)},unregister:function(e){t.getMapEventElement().removeEventListener("keydown",e)}})]},e.unregister=function(){this._listeners.forEach(function(t){t.unregister()}),this.clear()},t}(),SELECT_PROPERTIES:{SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT:"selectionPoint"}};t.TerraDrawMapLibreGLAdapter=/*#__PURE__*/function(t){var e,i;function r(e){var n;return(n=t.call(this,e)||this)._nextRender=void 0,n._map=void 0,n._container=void 0,n._rendered=!1,n.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},n._map=e.map,n._container=n._map.getContainer(),n}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,n(e,i);var o=r.prototype;return o.clearLayers=function(){var t=this;this._rendered&&(["point","linestring","polygon"].forEach(function(e){var n="td-"+e.toLowerCase();t._map.removeLayer(n),"polygon"===e&&t._map.removeLayer(n+"-outline"),t._map.removeSource(n)}),this._rendered=!1,this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0))},o._addGeoJSONSource=function(t,e){this._map.addSource(t,{type:"geojson",data:{type:"FeatureCollection",features:e},tolerance:0})},o._addFillLayer=function(t){return this._map.addLayer({id:t,source:t,type:"fill",paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})},o._addFillOutlineLayer=function(t){return this._map.addLayer({id:t+"-outline",source:t,type:"line",paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})},o._addLineLayer=function(t){return this._map.addLayer({id:t,source:t,type:"line",paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})},o._addPointLayer=function(t){return this._map.addLayer({id:t,source:t,type:"circle",paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})},o._addLayer=function(t,e){"Point"===e&&this._addPointLayer(t),"LineString"===e&&this._addLineLayer(t),"Polygon"===e&&(this._addFillLayer(t),this._addFillOutlineLayer(t))},o._addGeoJSONLayer=function(t,e){var n="td-"+t.toLowerCase();return this._addGeoJSONSource(n,e),this._addLayer(n,t),n},o._setGeoJSONLayerData=function(t,e){var n="td-"+t.toLowerCase();return this._map.getSource(n).setData({type:"FeatureCollection",features:e}),n},o.updateChangedIds=function(t){var e=this;[].concat(t.updated,t.created).forEach(function(t){"Point"===t.geometry.type?e.changedIds.points=!0:"LineString"===t.geometry.type?e.changedIds.linestrings=!0:"Polygon"===t.geometry.type&&(e.changedIds.polygons=!0)}),t.deletedIds.length>0&&(this.changedIds.deletion=!0),0===t.created.length&&0===t.updated.length&&0===t.deletedIds.length&&(this.changedIds.styling=!0)},o.getLngLatFromEvent=function(t){var e=this._container.getBoundingClientRect();return this.unproject(t.clientX-e.left,t.clientY-e.top)},o.getMapEventElement=function(){return this._map.getCanvas()},o.setDraggability=function(t){t?(this._map.dragRotate.enable(),this._map.dragPan.enable()):(this._map.dragRotate.disable(),this._map.dragPan.disable())},o.project=function(t,e){var n=this._map.project({lng:t,lat:e});return{x:n.x,y:n.y}},o.unproject=function(t,e){var n=this._map.unproject({x:t,y:e});return{lng:n.lng,lat:n.lat}},o.setCursor=function(t){var e=this._map.getCanvas();"unset"===t?e.style.removeProperty("cursor"):e.style.cursor=t},o.setDoubleClickToZoom=function(t){t?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()},o.render=function(t,e){var n=this;this.updateChangedIds(t),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(function(){for(var i=[].concat(t.created,t.updated,t.unchanged),r=[],o=[],a=[],s=0;s<i.length;s++){var l=i[s],c=l.properties,d=e[c.mode](l);"Point"===l.geometry.type?(c.pointColor=d.pointColor,c.pointOutlineColor=d.pointOutlineColor,c.pointOutlineWidth=d.pointOutlineWidth,c.pointWidth=d.pointWidth,r.push(l)):"LineString"===l.geometry.type?(c.lineStringColor=d.lineStringColor,c.lineStringWidth=d.lineStringWidth,o.push(l)):"Polygon"===l.geometry.type&&(c.polygonFillColor=d.polygonFillColor,c.polygonFillOpacity=d.polygonFillOpacity,c.polygonOutlineColor=d.polygonOutlineColor,c.polygonOutlineWidth=d.polygonOutlineWidth,a.push(l))}if(n._rendered){var h,u=n.changedIds.deletion||n.changedIds.styling,p=u||n.changedIds.linestrings,g=u||n.changedIds.polygons;(u||n.changedIds.points)&&(h=n._setGeoJSONLayerData("Point",r)),p&&n._setGeoJSONLayerData("LineString",o),g&&n._setGeoJSONLayerData("Polygon",a),h&&n._map.moveLayer(h)}else{var f=n._addGeoJSONLayer("Point",r);n._addGeoJSONLayer("LineString",o),n._addGeoJSONLayer("Polygon",a),n._rendered=!0,f&&n._map.moveLayer(f)}n.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}})},o.clear=function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())},o.getCoordinatePrecision=function(){return t.prototype.getCoordinatePrecision.call(this)},o.unregister=function(){return t.prototype.unregister.call(this)},o.register=function(e){var n;t.prototype.register.call(this,e),null!=(n=this._currentModeCallbacks)&&n.onReady&&this._currentModeCallbacks.onReady()},r}(k.TerraDrawBaseAdapter)});
//# sourceMappingURL=terra-draw-maplibre-gl-adapter.umd.js.map
